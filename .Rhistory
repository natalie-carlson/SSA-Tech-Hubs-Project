cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Always NBFC", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", omit = c("stateid", "mfiuniqueid"), omit.labels = c("State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Switch", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", omit = c("stateid", "mfiuniqueid"), omit.labels = c("State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Full Sample", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)",  single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
table(stateid)
table(master$stateid)
table(master$mfiuniqueid)
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Always NGO", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Always NBFC", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Switch", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
library(arm)
library(stargazer)
library(pastecs)
library(xtable)
library(sandwich)
library(dplyr)
#Clustering Function
clx <- function(fm, dfcw, cluster){
# reweighting the var-cov matrix for the within model
library(sandwich);library(lmtest)
M <- length(unique(cluster))
N <- length(cluster)
K <- fm$rank
dfc <- (M/(M-1))*((N-1)/(N-K))
uj  <- apply(estfun(fm),2, function(x) tapply(x, cluster, sum));
vcovCL <- dfc*sandwich(fm, meat=crossprod(uj)/N)*dfcw
return(vcovCL) }
master <- read.csv('/Users/nataliecarlson/Desktop/Microfinance/Data/master_v2_reg.csv', header=TRUE, stringsAsFactors=FALSE)
always_ngo <- filter(master, always_ngo==1)
always_nbfc <- filter(master, always_nbfc==1)
switch <- filter(master, switch==1)
## Hiring, Training & Compensation
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +		ap_close  + stateid + mfiuniqueid , data=master, na.action = na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +	 	ap_close  + stateid + mfiuniqueid , data=always_ngo, na.action = na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +	 	ap_close  + stateid + mfiuniqueid , data=always_nbfc, na.action = na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly  +	 	ap_close  + stateid + mfiuniqueid , data=switch, na.action = na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Management Practices", dep.var.labels = "", dep.var.caption = "Branch Productivity", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("BM background in banking", "BM background in development", "BM training emphasis on mission/values", "BM salary", "BM has incentive pay", "Collect monthly", "Diff: Days worked by BM beyond LO", "BM work hours per month", "BM selfish (dictator game)", "Branch has social activities"), omit = c("fg_n_comp_mfi", "ap_close", "bm_branch_age", "bm_b3_gender", "bm_b2_age", "bm_b7_educationint", "bm_b9_hh", "stateid", "mfiuniqueid"), omit.labels = c("Controls", "Controls", "Controls", "Controls", "Controls", "Controls", "Controls","State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
default1 <- lm(default_client_prop ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +	 	ap_close  + stateid + mfiuniqueid , data=master, na.action = na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(default1)))])
cov1   <- clx(default1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
default2 <- lm(default_client_prop ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +	 	ap_close  + stateid + mfiuniqueid , data=always_ngo, na.action = na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(default2)))])
cov1   <- clx(default2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
default3 <-  lm(default_client_prop ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +	 	ap_close  + stateid + mfiuniqueid , data=always_nbfc, na.action = na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(default3)))])
cov1   <- clx(default3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
default4 <-  lm(default_client_prop ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly +	 	ap_close  + stateid + mfiuniqueid , data=switch, na.action = na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(default4)))])
cov1   <- clx(default4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(default1, default2, default3, default4, title="Default Regressions: Management Practices", dep.var.labels = "", dep.var.caption = "Client Default", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("BM background in banking", "BM background in development", "BM training emphasis on mission/values", "BM salary", "BM has incentive pay", "Collect monthly", "Diff: Days worked by BM beyond LO", "BM work hours per month", "BM selfish (dictator game)", "Branch has social activities"), omit = c("fg_n_comp_mfi", "ap_close", "bm_branch_age", "bm_b3_gender", "bm_b2_age", "bm_b7_educationint", "bm_b9_hh", "stateid", "mfiuniqueid"), omit.labels = c("Controls", "Controls", "Controls", "Controls", "Controls", "Controls", "Controls","State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
retention1 <-  lm(retention1 ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly  +	 	ap_close  + stateid + mfiuniqueid , data=master, na.action = na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(retention1)))])
cov1   <- clx(retention1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
retention2 <- lm(retention1 ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly  +	 	ap_close  + stateid + mfiuniqueid , data=always_ngo, na.action = na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(retention2)))])
cov1   <- clx(retention2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
retention3 <- lm(retention1 ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly  +	 	ap_close  + stateid + mfiuniqueid , data=always_nbfc, na.action = na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(retention3)))])
cov1   <- clx(retention3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
retention4 <- lm(retention1 ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + collect_monthly  +	 	ap_close  + stateid + mfiuniqueid , data=switch, na.action = na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(retention4)))])
cov1   <- clx(retention4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(retention1, retention2, retention3, retention4, title="Retention Regressions: Management Practices", dep.var.labels = "", dep.var.caption = "Client Retention", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("BM background in banking", "BM background in development", "BM training emphasis on mission/values", "BM salary", "BM has incentive pay", "Collect monthly", "Diff: Days worked by BM beyond LO", "BM work hours per month", "BM selfish (dictator game)", "Branch has social activities"), omit = c("fg_n_comp_mfi", "ap_close", "bm_branch_age", "bm_b3_gender", "bm_b2_age", "bm_b7_educationint", "bm_b9_hh", "stateid", "mfiuniqueid"), omit.labels = c("Controls", "Controls", "Controls", "Controls", "Controls", "Controls", "Controls","State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
## GAMES
#DICTATOR
bm_dictator1 <- lm(bm_dictator_give ~ lo_dictator_give +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + bm_bg_banking + bm_bg_dev + stateid +  mfiuniqueid, master, na.action = na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(bm_dictator1)))])
cov1   <- clx(bm_dictator1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
bm_dictator2 <- lm(bm_dictator_give ~ lo_dictator_give +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + bm_bg_banking + bm_bg_dev + stateid +  mfiuniqueid, always_ngo, na.action = na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(bm_dictator2)))])
cov1   <- clx(bm_dictator2, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
bm_dictator3 <- lm(bm_dictator_give ~ lo_dictator_give +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + bm_bg_banking + bm_bg_dev + stateid +  mfiuniqueid, always_nbfc, na.action = na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(bm_dictator3)))])
cov1   <- clx(bm_dictator3, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
bm_dictator4 <- lm(bm_dictator_give ~ lo_dictator_give +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + bm_bg_banking + bm_bg_dev + stateid +  mfiuniqueid, switch, na.action = na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(bm_dictator4)))])
cov1   <- clx(bm_dictator4, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
stargazer(bm_dictator1, bm_dictator2, bm_dictator3, bm_dictator4, title="Dictator Game: Branch Manager", dep.var.labels = "", dep.var.caption = "Proportion Given by Branch Manager", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("Average proportion given by loan officers", "BM salary", "BM has incentive pay", "BM: The goals of this organization are not clear to me", "BM: Our company's products reflect our professional dedication to our mission statement", "BM: Our company contributes positively to the community", "BM: I sometimes feel my job is meaningless", "BM work days per month", "BM background in banking", "BM background in development"), omit = c("stateid", "mfiuniqueid"), omit.labels = c("State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
lo_dictator1 <- lm(lo_dictator_give ~ bm_dictator_give +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, master, na.action = na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(lo_dictator1)))])
cov1   <- clx(lo_dictator1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
lo_dictator2 <- lm(lo_dictator_give ~ bm_dictator_give +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, always_ngo, na.action = na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(lo_dictator2)))])
cov1   <- clx(lo_dictator2, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
lo_dictator3 <- lm(lo_dictator_give ~ bm_dictator_give +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, always_nbfc, na.action = na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(lo_dictator3)))])
cov1   <- clx(lo_dictator3, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
lo_dictator4 <- lm(lo_dictator_give ~ bm_dictator_give +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, switch, na.action = na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(lo_dictator4)))])
cov1   <- clx(lo_dictator4, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
stargazer(lo_dictator1, lo_dictator2, lo_dictator3, lo_dictator4, title="Dictator Game: Loan Officers", dep.var.labels = "", dep.var.caption = "Proportion Given by Loan Officer", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("Average proportion given by branch manager", "LO salary", "LO has incentive pay", "LO: The goals of this organization are not clear to me", "LO: Our company's products reflect our professional dedication to our mission statement", "LO: Our company contributes positively to the community", "LO: I sometimes feel my job is meaningless", "LO work days per month"), omit = c("stateid", "mfiuniqueid"), omit.labels = c("State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
# COMMUNAL POT
# bm_pot1 <- lm(bm_pot_contrib_expected ~ lo_pot_contrib_expected +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + stateid +  mfiuniqueid, master, na.action = na.omit)
# master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(bm_pot1)))])
# cov1   <- clx(bm_pot1, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# bm_pot2 <- lm(bm_pot_contrib_expected ~ lo_pot_contrib_expected +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + stateid +  mfiuniqueid, always_ngo, na.action = na.omit)
# master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(bm_pot2)))])
# cov1   <- clx(bm_pot2, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# bm_pot3 <- lm(bm_pot_contrib_expected ~ lo_pot_contrib_expected +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + stateid +  mfiuniqueid, always_nbfc, na.action = na.omit)
# master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(bm_pot3)))])
# cov1   <- clx(bm_pot3, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# bm_pot4 <- lm(bm_pot_contrib_expected ~ lo_pot_contrib_expected +  bm_f2_salary + 	bm_f3_incentive + bm_j_10 + bm_j_24 + bm_j_29 + bm_j_30 + bm_days_permonth + stateid +  mfiuniqueid, switch, na.action = na.omit)
# master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(bm_pot4)))])
# cov1   <- clx(bm_pot4, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# stargazer(bm_pot1, bm_pot2, bm_pot3, bm_pot4, title="Communal Pot Game: Branch Manager's Trust", dep.var.labels = "", dep.var.caption = "Branch Manager's Expectation of Coworkers' Contribution", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("Loan officers' expectation of coworkers' contribution", "BM salary", "BM has incentive pay", "BM: The goals of this organization are not clear to me", "BM: Our company's products reflect our professional dedication to our mission statement", "BM: Our company contributes positively to the community", "BM: I sometimes feel my job is meaningless", "BM work days per month"), omit = c("stateid", "mfiuniqueid"), omit.labels = c("State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
#
#
# lo_pot1 <- lm(lo_pot_contrib_expected ~ bm_pot_contrib_expected +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, master, na.action = na.omit)
# master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(lo_pot1)))])
# cov1   <- clx(lo_pot1, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# lo_pot2 <- lm(lo_pot_contrib_expected ~ bm_pot_contrib_expected +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, always_ngo, na.action = na.omit)
# master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(lo_pot2)))])
# cov1   <- clx(lo_pot2, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# lo_pot3 <- lm(lo_pot_contrib_expected ~ bm_pot_contrib_expected +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, always_nbfc, na.action = na.omit)
# master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(lo_pot3)))])
# cov1   <- clx(lo_pot3, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# lo_pot4 <- lm(lo_pot_contrib_expected ~ bm_pot_contrib_expected +  lo_salary + 	lo_incentive + lo_j_7 + lo_j_20 + lo_j_25 + lo_j_26 + lo_days_permonth + stateid +  mfiuniqueid, switch, na.action = na.omit)
# master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(lo_pot4)))])
# cov1   <- clx(lo_pot4, 1, master.x$mfiuniqueid)
# cluster.se1   <- sqrt(diag(cov1))
#
# stargazer(lo_pot1, lo_pot2, lo_pot3, lo_pot4, title="Communal Pot Game: Loan Officer's Trust", dep.var.labels = "", dep.var.caption = "Loan Officers' Expectation of Coworkers' Contribution", column.labels=c("Full Sample", "Always NGO", "Always NBFC", "Switch"), covariate.labels = c("Branch manager's expectation of coworkers' contribution", "LO salary", "LO has incentive pay", "LO: The goals of this organization are not clear to me", "LO: Our company's products reflect our professional dedication to our mission statement", "LO: Our company contributes positively to the community", "LO: I sometimes feel my job is meaningless", "LO work days per month"), omit = c("stateid", "mfiuniqueid"), omit.labels = c("State dummies", "MFI dummies"), no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize")
#
## POWERPOINT FIGURES
## Salary Comparison Figure
library(ggplot2)
master$type[master$always_ngo==1] <- "Always NGO"
master$type[master$always_nbfc==1] <- "Always NBFC"
master$type[master$switch==1] <- "Switch"
library(reshape)
master2 <- as.data.frame(master$type)
master2$Salary <- master$lo_salary
master2$Bonus <- master$lo_pay_bonus
master2 <-aggregate(master2, by=list(master$type),
FUN=mean, na.rm=TRUE)
master2 <- melt(master2, id="Group.1")
ggplot(master2, aes(x=Group.1, y=value, fill=variable)) + geom_bar(stat = "identity") + ggtitle("Average LO Compensation by Ownership Type") + xlab("Type") + ylab("Average Monthly Compensation in Rupees")
## TEST REGRESSIONS
# Full Sample
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, master, na.action=na.omit)
master.x <- na.omit(master[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Full Sample", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)",  single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, always_ngo, na.action=na.omit)
master.x <- na.omit(always_ngo[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Always NGO", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, always_nbfc, na.action=na.omit)
master.x <- na.omit(always_nbfc[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Always NBFC", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
productivity1 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity1)))])
cov1   <- clx(productivity1, 1, master.x$mfiuniqueid)
cluster.se1   <- sqrt(diag(cov1))
productivity2 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity2)))])
cov1   <- clx(productivity2, 1, master.x$mfiuniqueid)
cluster.se2   <- sqrt(diag(cov1))
productivity3 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + mfiuniqueid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity3)))])
cov1   <- clx(productivity3, 1, master.x$mfiuniqueid)
cluster.se3   <- sqrt(diag(cov1))
productivity4 <- lm(productivity_std ~ 	bm_bg_banking + 	bm_bg_dev + 	bm_training_mission + bm_f2_salary + 	bm_f3_incentive + lo_salary + lo_incentive + collect_monthly + stateid + mfiuniqueid, switch, na.action=na.omit)
master.x <- na.omit(switch[ , c("mfiuniqueid", all.vars(formula(productivity4)))])
cov1   <- clx(productivity4, 1, master.x$mfiuniqueid)
cluster.se4   <- sqrt(diag(cov1))
stargazer(productivity1, productivity2, productivity3, productivity4, title="Productivity Regressions: Switch", dep.var.labels = "", dep.var.caption = "Productivity Measure (Standardized)", single.row = TRUE, no.space = T, digits = 2, df=F, omit.stat=c("ll", "f", "ser", "adj.rsq"), font.size = "footnotesize", se = list(cluster.se1,cluster.se2, cluster.se3, cluster.se4))
library(plyr)
library(dplyr)
library(ggplot2)
library(matrixStats)
library(tm)
library(knitr)
## SET DIRECTORY HERE
setwd("/Users/nataliecarlson/Desktop/Tech Hubs/SSA Project Data and Analysis")
#################################################
# DATA PROCESSING
#################################################
## READ IN MAIN DATA
descriptions <- read.csv("descriptions.csv", header=TRUE, stringsAsFactors=FALSE)
descriptions <- descriptions[,-1]
master <- read.csv("SSA_Startups_4.csv", header=TRUE, stringsAsFactors=FALSE)
master <- master[-1,13:884]
master[master==2] <- 0
#good_data <- filter(master, Q873_1=="" & Q873_2=="")
good_data <- master
good_data <- as.data.frame(sapply(good_data, as.numeric))
good_data <- good_data[,1:870]
num_responses <- colSums(good_data!=0, na.rm=TRUE)
average_scores <- colMeans(good_data, na.rm=TRUE)
standard_devs <- colSds(as.matrix(good_data), na.rm=TRUE)
descriptions$average_score <- average_scores
descriptions$score_sd <- standard_devs
descriptions$num_responses <- num_responses
descriptions$funding_dummy <- ifelse(descriptions$total_funding>0,1,0)
#drop those with no responses
descriptions <- filter(descriptions, num_responses!=0)
#drop outliers
outliers <- quantile(descriptions$total_funding, 0.99)
descriptions <- filter(descriptions, total_funding<outliers)
# CLEAN TEXT FOR TOPIC MODELING
company_details <- descriptions$descriptions
# lowercase
company_details <- tolower(company_details)
company_details <- gsub("[\r\n]", " ", company_details)
# Replace @UserName
company_details <- gsub("@\\w+", " ", company_details)
# Remove punctuation
company_details <- gsub("[[:punct:]]+", " ", company_details)
# Remove digits
company_details <- gsub("[[:digit:]]+", " ", company_details)
# Remove links
company_details <- gsub("http\\w+", " ", company_details)
myStopwords <- c(stopwords(), "e", "s", "m", "d", "t", "africa", "african", "kenya", "kenyan", "nigeria", "nigerian", "uganda", "ugandan", "ghana", "ghanaian", "www", "com", "will", "can", "dazaar", "co", "propeies", "poal", "staups", "enteainment", "â", "pistis", "also", "right")
# Remove Stopwords
company_details <- removeWords(company_details, myStopwords)
# Remove blank spaces at the beginning
company_details <- gsub("^ ", "", company_details)
# Remove blank spaces at the end
company_details <- gsub(" $", "", company_details)
# Remove tabs
company_details <- gsub("[ |\t]{2,}", " ", company_details)
company_details <- gsub("^ *|(?<= ) | *$", "", company_details, perl = TRUE)
descriptions$clean_text <- company_details
## REMOVE DUPLICATES
descriptions$dup1 <- duplicated(descriptions[,1], fromLast = TRUE)
descriptions$dup2 <- duplicated(descriptions[,1], fromLast = FALSE)
#all_duplicates <- filter(descriptions, (dup1==TRUE | dup2==TRUE))
#all_duplicates <- all_duplicates[order(all_duplicates$descriptions),]
duplicates <- filter(descriptions, dup1==TRUE)
descriptions <- filter(descriptions, dup1==FALSE)
descriptions$match <- match(descriptions$descriptions, duplicates$descriptions, nomatch=0)
#average scores for dups
for (i in 1:nrow(descriptions)) {
if (descriptions$dup2[i]==TRUE){
n <- descriptions$match[i]
count <- duplicates$num_responses[n] + descriptions$num_responses[i]
descriptions$average_score[i] <- (duplicates$average_score[n] * (duplicates$num_responses[n]/count)) + (descriptions$average_score[i] * (descriptions$num_responses[i]/count))
descriptions$num_responses[i] <- count
}
}
## CATEGORIES
categories <- read.csv("category_matrix_3.csv", header=TRUE, stringsAsFactors=FALSE)
categories <- categories[,-1]
categories$descriptions <- NULL
descriptions_categories <- merge(descriptions, categories, by.x = c("names"), by.y=c("names"), all.x = TRUE, all.y = FALSE)
descriptions_categories$dup1 <- duplicated(descriptions_categories$descriptions, fromLast = TRUE)
descriptions_categories <- filter(descriptions_categories, dup1==FALSE)
#################################################
# TABLES AND FIGURES
#################################################
# FIGURE X: PROPORTION OF FIRMS FUNDED BY SCORE
bin_descriptions <- data.frame(descriptions, bin=cut(descriptions$average_score, c(0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1), include.lowest=TRUE))
ggplot(bin_descriptions, aes(x=bin, y=funding_dummy)) + stat_summary(fun.y="mean", geom="bar") + xlab("Less Social <--- Average mTurk Score ---> More Social") + ylab("Proportion of Firms Funded")
#TABLE X: Words selected by LASSO model for predicting mTurk score
library(quanteda)
dtm <- dfm(descriptions$descriptions, removePunct = TRUE, ignoredFeatures = c(stopwords(), "â"))
dtm <- trim(dtm, minCount=5, minDoc=5)
dtm <- as.data.frame(dtm)
dtm$average_score <- descriptions$average_score
#dtm$funding_dummy <- descriptions$funding_dummy
#dtm$total_funding <- descriptions$total_funding
library(useful)
theForm <- average_score ~ .
#theForm <- funding_dummy ~ .
#theForm <- total_funding ~ .
masterX <- build.x(theForm, data=dtm)
masterY <- build.y(theForm, data=dtm)
library(glmnet)
set.seed(102)
glm1<-glmnet(x=masterX,y=masterY,alpha=1,family='gaussian')
plot(glm1, xvar="lambda", label=TRUE)
cv.glm1 <- cv.glmnet(x=masterX,y=masterY,alpha=1,family='gaussian')
plot(cv.glm1)
best_lambda <- cv.glm1$lambda.min
best_lambda
glm1<-glmnet(x=masterX,y=masterY,alpha=1,family='gaussian', lambda=best_lambda)
#coef(glm1)
#coefficient table
ind <- which(coef(glm1) != 0)
df <- data.frame(
Feature=rownames(coef(glm1))[ind],
Coefficient=coef(glm1)[ind]
)
df <- df[order(df$Coefficient),]
library(xtable)
xtable(df, format="latex", include.rownames = FALSE)
coef_table <- xtable(df, format="latex")
print(coef_table, include.rownames = FALSE, size="small")
## TABLE X: LIKELIHOOD OF GETTING FUNDED BASED ON SCORE
library(stargazer)
drops <- c("total_funding","names", "descriptions", "wordcount", "score_sd", "num_responses", "clean_text", "dup1", "dup2", "match", "investors", "investor_type", "funding_type", "funding_rounds")
dummy_df<- descriptions_categories[ , !(names(descriptions_categories) %in% drops)]
binomial1 <- glm(funding_dummy ~ average_score + I(average_score^2) + country, dummy_df, family="binomial")
binomial2 <- glm(funding_dummy ~ average_score  + I(average_score^2) + country + Software + Mobile + E.Commerce + Education, dummy_df, family="binomial")
binomial3 <- glm(funding_dummy ~ average_score + I(average_score^2) + country + Software + Mobile + E.Commerce + Education + ., dummy_df, family="binomial")
stargazer(binomial1, binomial2, binomial3, title="Logistic Regression of Funding Dummy on mTurk Score", dep.var.labels="", dep.var.caption = "Funding indicator", covariate.labels = c("mTurk Score", "mTurk Score*2", "Kenya", "Nigeria", "Uganda", "Software", "Mobile", "E-Commerce", "Education"), column.labels=c("Model 1", "Model 2", "Model 3"), omit =c(11:224), no.space = T, digits = 2, omit.stat=c("aic"), size="footnotesize")
## TABLE X: LIKELIHOOD OF PARTICULAR TYPES OF FUNDING
# Process funding types
funding_types <- lapply(descriptions_categories$funding_type, function(x) strsplit(x, "\\|"))
all_funding_types <- unique(unlist(funding_types))
funding_matrix <- data.frame(matrix(0, nrow=length(funding_types), ncol=length(all_funding_types)))
colnames(funding_matrix) <- all_funding_types
for (i in 1:nrow(funding_matrix)) {
for (j in 1:length(all_funding_types)){
if (all_funding_types[j] %in% funding_types[[i]][[1]]) funding_matrix[i,j] <- 1
}
}
funding_matrix$venture_or_pe <- ifelse(funding_matrix$venture==1 | funding_matrix$private_equity==1, 1, 0)
descriptions_categories$venture_or_pe <- funding_matrix$venture_or_pe
descriptions_categories$seed <- funding_matrix$seed
one_round <- filter(descriptions_categories, funding_rounds<2)
drops <- c("total_funding", "seed", "names", "descriptions", "wordcount", "score_sd", "num_responses", "clean_text", "dup1", "dup2", "match", "venture_or_pe", "funding_type", "funding_rounds", "investors", "two_or_more")
one_round<- one_round[ , !(names(one_round) %in% drops)]
binomial1 <- glm(funding_dummy ~ average_score + I(average_score^2) + country + ., data = one_round, family = "binomial")
drops <- c("total_funding", "funding_dummy", "names", "descriptions", "wordcount", "score_sd", "num_responses", "clean_text", "dup1", "dup2", "match", "venture_or_pe", "funding_type", "funding_rounds", "investors", "two_or_more")
seed_df<- descriptions_categories[ , !(names(descriptions_categories) %in% drops)]
binomial3 <- glm(seed ~ average_score + I(average_score^2) + country + ., data = seed_df, family = "binomial")
drops <- c("total_funding", "funding_dummy", "names", "descriptions", "wordcount", "score_sd", "num_responses", "clean_text", "dup1", "dup2", "match", "seed", "funding_type", "funding_rounds", "investors", "two_or_more")
venture_df<- descriptions_categories[ , !(names(descriptions_categories) %in% drops)]
binomial4 <- glm(venture_or_pe ~ average_score + I(average_score^2) + country + ., data = venture_df, family = "binomial")
descriptions_categories$two_or_more <- ifelse(descriptions_categories$funding_rounds>1, 1, 0)
drops <- c("total_funding", "funding_dummy", "seed", "names", "descriptions", "wordcount", "score_sd", "num_responses", "clean_text", "dup1", "dup2", "match", "venture_or_pe", "funding_type", "funding_rounds", "investors")
funded_only <- descriptions_categories[ , !(names(descriptions_categories) %in% drops)]
binomial2 <- glm(two_or_more ~ average_score + I(average_score^2) + country + ., data = funded_only, family = "binomial")
stargazer(binomial1, binomial2, binomial3, binomial4, title="Specific Types of Funding Outcomes", dep.var.labels=c("", "", "", ""), dep.var.caption = "Funding Indicators", covariate.labels = c("mTurk Score", "mTurk Score*2", "Kenya", "Nigeria", "Uganda"), column.labels=c("First Funding Round", "Subsequent Funding Rounds", "Seed Funding", "Venture/PE Funding"), omit =c(7:224), no.space = T, digits = 2, omit.stat=c("aic"), font.size = "footnotesize")
## TOPICS
library("lda")
library("ggplot2")
corpus <- lexicalize(descriptions$clean_text)
alpha <- 1/22
eta <- 1/22
set.seed(110)
#set.seed(104)
#set.seed(103)
model <- lda.collapsed.gibbs.sampler(corpus$documents, 22, corpus$vocab, 1000, alpha = alpha, eta = eta, compute.log.likelihood=T, trace=0L)
topics <- top.topic.words(model$topics, n=7)
topics
